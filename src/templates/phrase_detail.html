{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center animate__animated animate__fadeIn">
    <div class="col-lg-8">
        <div class="d-flex align-items-center mb-4 gap-3">
            <a href="/" class="btn btn-outline-secondary rounded-pill border-0">
                <i class="bi bi-arrow-left fs-4"></i>
            </a>
            <h1 class="oswald mb-0">Detalle de Sabiduría</h1>
        </div>

        <div class="glass-card p-5 mb-5 border-top border-warning border-4">
            <div class="mb-4">
                <span class="badge bg-warning text-dark text-uppercase letter-spacing-2 mb-3">
                    {{ phrase.kind if phrase.kind == 'Phrase' else 'Dicho Cuñadil' }}
                </span>
                <blockquote class="display-5 fw-bold mb-0" style="line-height: 1.2;">
                    "{{ phrase.text }}"
                </blockquote>
            </div>

            <hr class="border-secondary border-opacity-25 my-5">

            <div class="row g-4">
                <div class="col-md-6">
                    <div class="stat-card p-4 rounded-4 bg-dark bg-opacity-25 border border-secondary border-opacity-10">
                        <div class="text-secondary small text-uppercase fw-bold mb-2">Impacto Total</div>
                        <div class="d-flex align-items-baseline gap-2">
                            <span class="display-6 fw-bold text-warning">{{ phrase.usages }}</span>
                            <span class="text-secondary">intervenciones</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="stat-card p-4 rounded-4 bg-dark bg-opacity-25 border border-secondary border-opacity-10">
                        <div class="text-secondary small text-uppercase fw-bold mb-2">Autoría Original</div>
                        {% if contributor %}
                        <div class="d-flex align-items-center gap-3">
                            <div class="rounded-circle border border-warning border-opacity-25 d-flex align-items-center justify-content-center fw-bold text-dark overflow-hidden shadow-sm"
                                 style="width: 56px; height: 56px; background: var(--bs-secondary);">
                                <img src="/user/{{ contributor.user_id or contributor.chat_id }}/photo.png"
                                     alt="{{ contributor.name }}"
                                     class="img-fluid"
                                     onerror="this.style.display='none'; this.parentElement.innerHTML='{{ contributor.name.lstrip('@')|first|upper }}'">
                            </div>
                            <div>
                                {% if contributor.username %}
                                <a href="https://t.me/{{ contributor.username }}" class="text-decoration-none link-light">
                                    <div class="fw-bold fs-5">{{ contributor.name }}</div>
                                    <div class="small text-warning">@{{ contributor.username }}</div>
                                </a>
                                {% else %}
                                <div class="fw-bold text-white fs-5">{{ contributor.name }}</div>
                                <div class="small text-secondary">ID: {{ contributor.user_id or contributor.chat_id }}</div>
                                {% endif %}
                            </div>
                        </div>
                        {% else %}
                        <div class="d-flex align-items-center gap-3">
                            <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center fw-bold text-dark shadow-sm" style="width: 56px; height: 56px;">
                                <i class="bi bi-person-fill fs-4"></i>
                            </div>
                            <div>
                                <div class="fw-bold text-white fs-5">{% if phrase.user_id and phrase.user_id != 0 %}{{ phrase.user_id }}{% else %}Anónimo{% endif %}</div>
                                <div class="small text-secondary">Contribuidor</div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <i class="bi bi-volume-up text-info fs-3 mb-2 d-block"></i>
                        <div class="fw-bold">{{ phrase.audio_usages }}</div>
                        <div class="small text-secondary text-uppercase">Audios</div>
                    </div>
                </div>
                <div class="col-md-4 border-start border-end border-secondary border-opacity-10">
                    <div class="text-center p-3">
                        <i class="bi bi-sticky text-warning fs-3 mb-2 d-block"></i>
                        <div class="fw-bold">{{ phrase.sticker_usages }}</div>
                        <div class="small text-secondary text-uppercase">Stickers</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <i class="bi bi-calendar3 text-success fs-3 mb-2 d-block"></i>
                        <div class="fw-bold">{{ phrase.created_at.strftime('%d/%m/%Y') if phrase.created_at else '---' }}</div>
                        <div class="small text-secondary text-uppercase">Registrada</div>
                    </div>
                </div>
            </div>
        </div>

        {% if phrase.sticker_file_id %}
        <div class="glass-card p-4 text-center animate__animated animate__fadeInUp animate__delay-1s">
            <h5 class="oswald mb-4">Sticker Oficial</h5>
            <div class="sticker-preview mx-auto mb-3" style="width: 256px; height: 256px; background: rgba(255,255,255,0.05); border-radius: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                <img src="/phrase/{{ phrase.key }}/sticker.png" alt="Sticker" class="img-fluid" style="max-height: 100%; transition: transform 0.3s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
            </div>
            <div class="small text-secondary font-monospace">{{ phrase.sticker_file_id }}</div>
        </div>
        {% endif %}
    </div>
</div>

<style>
    .letter-spacing-2 { letter-spacing: 2px; }
    .stat-card { transition: all 0.3s; }
    .stat-card:hover { background: rgba(255,255,255,0.05) !important; border-color: var(--primary-gold) !important; }
</style>
{% endblock %}
